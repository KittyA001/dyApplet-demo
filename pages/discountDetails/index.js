let list = [
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 84,
    unitPrice: 884,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 19,
    unitPrice: 619,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: null,
    surplus: 6,
    percentage: 60,
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 13,
    unitPrice: 443,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 1,
    unitPrice: 31,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: null,
    surplus: 8,
    percentage: 0,
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.02,
    prodType: 10,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: '123',
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: 50,
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  },
  {
    buyNum: "3601",
    couponProdListVo: null,
    cover: "https://knowledge-payment.oss-cn-beijing.aliyuncs.com/13/resource/admin-fe_lj7l_CsrpRATJH2sjbTAB4pSb.png?x-oss-process=image/auto-orient,1/resize,m_lfit,w_600/quality,q_100",
    flashSalesForProd: null,
    headimgurl: "https://ckjr-lib-1256159786.cos.ap-shanghai.myqcloud.com//TIKTOK/1442690456172453889/202202/A65X2i2pKxcbYFcx_1645760534513.jpg",
    id: "1527165249394475009",
    isSoldSeparately: 1,
    name: "CZ单节部分试听多节8.27-2",
    payType: 2,
    price: 0.01,
    unitPrice: 19.9,
    prodType: 111,
    recordType: null,
    talentDesc: null,
    talentName: "创客匠人平台2达人",
    talentType: null,
    talentTypeName: null
  }
]
let { ttRequestPost } = require("../../utils/util")

Page({
  data: {
    list: [],
    pageNo: 1,
    size: 10,
    total: '',
    loading: false,
    finish: false
  },
//   let url = "dyhomepage/discountZone";
//     let postData = {
//         "pageNo": this.pageIndex,
//         "pageSize": 6,
//       }
async getList() {
  this.setData({
    "loading": true
  })
  try {
    let info = await ttRequestPost('dyhomepage/discountZone',{
      pageNo: this.data.pageNo,
      pageSize: this.data.size,
    })
    console.log('info', info)
    let arr = this.data.list
    let arrList = info.records
    arrList.forEach(item => {
      if (item.flashSalesForProd.lastCount > 0) {
        if (item.flashSalesForProd.lastCount == 0) {
          item['salesPercent'] = 100
        } else if (item.flashSalesForProd.salesLimit == item.flashSalesForProd.lastCount) {
          item['salesPercent'] = 50
        } else {
          item['salesPercent'] = 50 + ((item.flashSalesForProd.salesLimit - item.flashSalesForProd.lastCount)/item.flashSalesForProd.salesLimit)*50
        }
      }
    })
    console.log('arrList',arrList)
    
    // for(let i = 0; i < arrList.length; i++) {
    //   if (arrList[i].flashSalesForProd.lastCount === 0) {
    //     arrList[i][]
    //   }
    // }
    arr.push(...arrList)
    // arr.push(...infoData.dyProdListVoList)
    this.setData({
      "list": arr,
      "total": info.total,
      "loading": false
    })
    // this.setData({
    //   "list": arr,
    //   "total": infoData.total,
    //   "loading": false
    // })
    
  } catch (e) {
    console.log(e)
  }
},
  onReachBottom() {
    this.setData({
      "loading": true
    })
    if (!this.data.finish) {
      let num = this.data.total/this.data.size
      // console.log('num', num)
      if (num > this.data.pageNo) {
      let pageNo = this.data.pageNo + 1
        this.setData({
          "pageNo": pageNo
        })
        // console.log('pageNo', this.data.pageNo)
        this.getList()
      } else {
        this.setData({
          "loading": false,
          "finish": true
        })
      }
    } else {
      this.setData({
        "loading": false
      })
    }
  
  },
  onLoad: function (options) {
    // this.setData({
    //   "list": list
    // })
    this.getList()
  }
})